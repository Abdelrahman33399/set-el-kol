<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <link rel="icon" href="../../Image_fx6.jpg" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الاختبار - علم نفس النمو</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: rgba(255, 255, 255, 0.05);
            --border-color: rgba(255, 255, 255, 0.1);
            --text-light: #e0e0e0;
            --primary-neon: linear-gradient(45deg, #a453ff, #54aaff);
            --accent-orange: #ff6b35;
        }
        .day-mode {
            --bg-color: #1b405f;
            --card-bg: rgba(255, 255, 255, 0.7);
            --text-light: #ec6211;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s;
        }
        .quiz-container, .final-form, .result-container {
            display: none;
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 20px;
            margin: 2rem auto;
            max-width: 800px;
            border: 1px solid var(--border-color);
        }
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .question-counter {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--accent-orange);
        }
        .question-text {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            color: var(--text-light);
            font-weight: 600;
        }
        .options-container {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .option-btn {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #ddd;
            padding: 1rem;
            border-radius: 12px;
            text-align: right;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.1rem;
        }
        .option-btn:hover {
            background: rgba(255, 107, 53, 0.2);
            color: var(--text-light);
        }
        .option-btn.selected {
            background: var(--accent-orange);
            color: white;
            transform: scale(1.02);
        }
        .option-btn.correct {
            background: #28a745;
            color: white;
        }
        .option-btn.wrong {
            background: #dc3545;
            color: white;
        }
        .essay-input {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            font-size: 1.1rem;
            resize: vertical;
            margin-bottom: 1.5rem;
        }
        .quiz-btns {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        .quiz-btn {
            padding: 12px 30px;
            border-radius: 30px;
            font-weight: 600;
            transition: all 0.3s;
            white-space: nowrap;
        }
        .next-btn, .submit-btn {
            background: var(--accent-orange);
            color: white;
        }
        .next-btn:hover, .submit-btn:hover {
            background: #e05a2a;
        }
        .restart-btn {
            background: #6c757d;
            color: white;
        }
        .back-btn {
            background: #28a745;
            color: white;
        }
        .result-score {
            font-size: 3rem;
            font-weight: 800;
            background: var(--primary-neon);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 1rem 0;
        }
        .result-text {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            color: var(--text-light);
        }
        .explanation {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            text-align: right;
            border-right: 4px solid var(--accent-orange);
        }
        .explanation h5 {
            color: var(--accent-orange);
            margin-bottom: 0.5rem;
        }
        .final-form input {
            width: 100%;
            padding: 12px;
            margin: 0.5rem 0;
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            font-size: 1.1rem;
        }
        .theme-toggle-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--accent-orange);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 1000;
        }
        .back-to-home-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--accent-orange);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <button id="themeToggle" class="theme-toggle-btn">
        <i class="fas fa-moon"></i>
    </button>

    <div class="container py-5">
        <div id="quizContainer" class="quiz-container">
            <div class="quiz-header">
                <div class="question-counter" id="questionCounter">السؤال 1 من 2</div>
                <button class="btn btn-outline-light" onclick="exitQuiz()">
                    <i class="fas fa-times"></i> إنهاء
                </button>
            </div>
            <div class="question-text" id="questionText">نص السؤال هنا...</div>
            <div class="options-container" id="optionsContainer"></div>
            <div class="quiz-btns">
                <button class="quiz-btn next-btn d-none" id="nextBtn" onclick="nextQuestion()">التالي</button>
                <button class="quiz-btn submit-btn d-none" id="submitEssayBtn" onclick="submitEssay()">تسليم</button>
            </div>
        </div>

        <div id="finalFormContainer" class="final-form">
            <h3 class="text-center mb-4">أدخل بياناتك</h3>
            <input type="text" id="studentName" placeholder="الاسم الكامل" required>
            <input type="text" id="studentId" placeholder="(ID)" required>
            <div class="quiz-btns mt-3">
                <button class="quiz-btn next-btn" onclick="saveStudentData()">حفظ</button>
            </div>
        </div>

        <div id="resultContainer" class="result-container">
            <h2>🎉 انتهيت من الاختبار!</h2>
            <div class="result-score" id="finalScore">0/2</div>
            <div class="result-text" id="resultText">أحسنت! واصل التميز 🌟</div>
            <div id="explanationsContainer"></div>
            <div class="mt-4">
                <h4>شارك نتيجتك أو احفظها</h4>
                <div class="input-group mb-3">
                    <span class="input-group-text">+<input type="text" id="countryCode" placeholder="رمز الدولة" style="max-width:80px; text-align:center;" value="20"></span>
                    <input type="text" id="phoneNumber" class="form-control" placeholder="رقم الهاتف (بدون صفر)">
                </div>
                <div class="quiz-btns">
                    <button class="quiz-btn back-btn" onclick="shareToWhatsApp()">
                        <i class="fab fa-whatsapp"></i> إرسال عبر واتساب
                    </button>
                    <button class="quiz-btn next-btn" onclick="downloadPDF()">
                        <i class="fas fa-file-pdf"></i> تحميل كـ PDF
                    </button>
                    <button class="quiz-btn restart-btn" onclick="restartQuiz()">
                        <i class="fas fa-redo"></i> إعادة الاختبار
                    </button>
                    <button class="quiz-btn back-btn" onclick="backToMaterials()">
                        <i class="fas fa-list"></i> العودة للمواد
                    </button>
                </div>
            </div>
        </div>

        <a href="materials.html" class="back-to-home-btn">
            <i class="fas fa-arrow-left me-2"></i> العودة للمواد
        </a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDeapYypO595vcDWUoh1gOncsGkQ5EZdyE",
            authDomain: "sit-el-kol.firebaseapp.com",
            projectId: "sit-el-kol",
            storageBucket: "sit-el-kol.firebasestorage.app",
            messagingSenderId: "573924344198",
            appId: "1:573924344198:web:fec2e9a54c1c152cd16c07"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.saveToFirebase = async function(data) {
            try {
                await addDoc(collection(db, "quiz_submissions"), data);
            } catch (e) {
                console.error("فشل حفظ البيانات:", e);
            }
        };
    </script>

    <script>
        const questions = [
    {
        type: "mcq",
        question: "أي من العبارات التالية تُعدّ تعريفًا دقيقًا لعلم نفس النمو من منظور تكاملي؟",
        options: [
            "دراسة السلوك البشري في المواقف الاجتماعية فقط",
            "فرع من علم النفس يدرس التغيرات العقلية والانفعالية والجسدية طوال دورة الحياة",
            "تحليل الاضطرابات النفسية عند المراهقين",
            "دراسة الذكاء عبر مراحل الطفولة"
        ],
        correct: 1,
        explanation: "علم نفس النمو يشمل جميع الجوانب (الجسدية، العقلية، الانفعالية، اللغوية، الاجتماعية) عبر دورة الحياة الكاملة من الإخصاب إلى الوفاة، وليس مقتصرًا على مرحلة أو جانب واحد."
    },
    {
        type: "mcq",
        question: "ما الهدف الأساسي من \"التدخل في التغيرات السلوكية\" في علم نفس النمو؟",
        options: [
            "تصنيف الأطفال حسب مستوى ذكائهم",
            "توجيه النمو وتحسينه عبر استراتيجيات تربوية مبنية على فهم علمي",
            "علاج الاضطرابات النفسية فقط",
            "مقارنة النمو بين الثقافات المختلفة"
        ],
        correct: 1,
        explanation: "التدخل لا يكون عشوائيًا، بل يعتمد على وصف دقيق وتفسير سليم للظواهر النمائية، ويهدف إلى تحسين النمو عبر أساليب تربوية أو علاجية مبنية على الأدلة."
    },
    {
        type: "mcq",
        question: "ما المقصود بـ \"الفترة الحرجة\" في النمو؟",
        options: [
            "مرحلة يزداد فيها النمو الجسدي فقط",
            "فترة يكون فيها الفرد أكثر استجابة للمؤثرات البيئية، والتدخل خارجها قد يكون غير فعّال",
            "مرحلة يُصاب فيها الطفل باضطرابات سلوكية",
            "وقت يبدأ فيه التفكير المجرد"
        ],
        correct: 1,
        explanation: "الفترات الحرجة (أو الحساسة) هي نوافذ زمنية يُظهر فيها الفرد حساسية شديدة للمؤثرات (مثل اكتساب اللغة)، والتدخل المبكر فيها ضروري لفعالية التعلم أو العلاج."
    },
    {
        type: "mcq",
        question: "وفقًا لبياجي، ما العملية المعرفية التي تحدث عندما يُعدّل الطفل مخططه الذهني لاستيعاب معلومة جديدة لا تناسب فهمه الحالي؟",
        options: [
            "التمثيل (Assimilation)",
            "التوازن (Equilibration)",
            "التكيّف (Accommodation)",
            "التعميم (Generalization)"
        ],
        correct: 2,
        explanation: "التكيّف هو تعديل أو إنشاء مخطط معرفي جديد لاستيعاب خبرة لا تتوافق مع المعرفة الحالية، مثل تغيير فهم الطفل لمفهوم \"العدالة\" بعد تجربة ظلم."
    },
    {
        type: "mcq",
        question: "في أي مرحلة من مراحل بياجي يبدأ الطفل في فهم مفاهيم مثل \"الحفاظ على الكمية\" (Conservation)؟",
        options: [
            "الحس-الحركية",
            "ما قبل العمليات",
            "العمليات المحسوسة",
            "العمليات المجردة"
        ],
        correct: 2,
        explanation: "في مرحلة العمليات المحسوسة (7–12 سنة)، يكتسب الطفل القدرة على فهم أن الكمية لا تتغير رغم تغيّر الشكل (مثل سكب الماء من كوب ضيق إلى واسع)."
    },
    {
        type: "mcq",
        question: "أي من العوامل التالية يُعدّ داخليًا يؤثر في النمو البشري؟",
        options: [
            "التنشئة الاجتماعية",
            "الوراثة",
            "المناهج الدراسية",
            "وسائل الإعلام"
        ],
        correct: 1,
        explanation: "العوامل الداخلية تشمل الوراثة، النضج، العوامل الفسيولوجية، بينما البيئة الاجتماعية والتربوية من العوامل الخارجية."
    },
    {
        type: "mcq",
        question: "وفقًا لفرويد، ما المرحلة التي يُشكّل فيها الطفل هويته الجنسية عبر \"عملية التوحّد\"؟",
        options: [
            "الفمية",
            "الشرجية",
            "القضيبية/الوديبية",
            "التناسلي"
        ],
        correct: 2,
        explanation: "في المرحلة القضيبية (4–6 سنوات)، يمر الطفل بـ عقدة أوديب/إلكترا، ثم يُقلّد الوالد من نفس جنسه لبناء هويته الجنسية والنفسية."
    },
    {
        type: "mcq",
        question: "ما الدور الأساسي للأنا (Ego) في البنية النفسية عند فرويد؟",
        options: [
            "تمثيل الغرائز دون قيود",
            "تطبيق القيم الأخلاقية المطلقة",
            "التوفيق بين رغبات الهو ومتطلبات الواقع",
            "كبت جميع الدوافع الجنسية"
        ],
        correct: 2,
        explanation: "الأنا تعمل وفق مبدأ الواقع، وتوازن بين رغبات الهو (الغرائز) وقيود الأنا العليا (الضمير) وقيود البيئة."
    },
    {
        type: "mcq",
        question: "أي من العبارات التالية تُعبّر عن مبدأ \"تكامل النمو\"؟",
        options: [
            "النمو العقلي يحدث بمعزل عن النمو الانفعالي",
            "التقدم في النمو اللغوي غالبًا ما يصاحبه تقدم في النمو الاجتماعي",
            "كل جانب من جوانب النمو له سرعة ثابتة",
            "النمو يبدأ بعد الولادة مباشرة"
        ],
        correct: 1,
        explanation: "مبدأ التكامل يشير إلى أن جوانب النمو متداخلة ومتفاعلة، فضعف في جانب (مثل التغذية) قد يؤثر على الجوانب الأخرى (مثل التركيز)."
    },
    {
        type: "mcq",
        question: "ما السبب الرئيسي لبطء النمو في مرحلة الرشد مقارنةً بالطفولة؟",
        options: [
            "توقف النضج العصبي",
            "انخفاض معدلات التغير الفسيولوجي والسلوكي",
            "قلة الخبرات البيئية",
            "انتهاء مراحل النمو"
        ],
        correct: 1,
        explanation: "النمو عملية مستمرة، لكن سرعته تتفاوت؛ ففي الرشد، التغيرات تكون أبطأ وأكثر استقرارًا مقارنةً بالانفجار النمائي في الطفولة والمراهقة."
    },
    {
        type: "mcq",
        question: "أي من المفكرين التاليين ربط بين النمو المعرفي واستخدام الوسائل المحسوسة في التعليم؟",
        options: [
            "فرويد",
            "إريكسون",
            "بياجي",
            "لوك"
        ],
        correct: 2,
        explanation: "بياجي أكد أن الأطفال في مرحلة العمليات المحسوسة يحتاجون إلى مواد ملموسة (كالقطع التعليمية، النماذج) لفهم المفاهيم، وهو ما يهم معلمي تكنولوجيا التعليم."
    },
    {
        type: "mcq",
        question: "ما العلاقة بين \"التوازن\" (Equilibration) ونمو الذكاء عند بياجي؟",
        options: [
            "التوازن يمنع التغيير المعرفي",
            "التوازن هو حالة سكون لا تؤثر على النمو",
            "التوازن هو القوة الدافعة للنمو عبر التفاعل بين التمثيل والتكيّف",
            "التوازن يعتمد فقط على العوامل الوراثية"
        ],
        correct: 2,
        explanation: "التوازن ليس سكونًا، بل عملية ديناميكية تدفع الطفل لتعديل معرفته عند مواجهة تناقض، مما يُولّد نموًا معرفيًا."
    },
    {
        type: "mcq",
        question: "أي من العوامل التالية يُفسّر تفاوت قدرة الطلاب على التفكير المجرد في المرحلة الثانوية؟",
        options: [
            "نوع الجنس فقط",
            "التخصص الدراسي، البيئة الثقافية، الأساليب المعرفية",
            "العمر الزمني فقط",
            "عدد الساعات الدراسية"
        ],
        correct: 1,
        explanation: "بياجي نفسه لاحظ أن الوصول إلى مرحلة العمليات المجردة ليس تلقائيًا، بل يتأثر بعوامل مثل الثقافة، التعليم، والأسلوب المعرفي (مستقل/معتمد على المجال)."
    },
    {
        type: "mcq",
        question: "ما الهدف من \"الوصف التفصيلي للحقائق النمائية\" في علم نفس النمو؟",
        options: [
            "تصنيف الأطفال كأذكياء أو أقل ذكاءً",
            "رصد التغيرات السلوكية وتوثيقها علميًا قبل تفسيرها",
            "تصميم اختبارات ذكاء قياسية",
            "مقارنة المجتمعات النامية والمتقدمة"
        ],
        correct: 1,
        explanation: "الوصف هو المرحلة الأولى في المنهج العلمي، حيث يُجمَعُ البيانات الموضوعية عن السلوك قبل محاولة تفسيرها أو التدخل فيها."
    },
    {
        type: "mcq",
        question: "لماذا يُعدّ فهم \"الخصائص النمائية لكل مرحلة\" ضروريًا للمعلم في تكنولوجيا التعليم؟",
        options: [
            "لاختيار الألوان المناسبة في العروض التقديمية",
            "لتصميم أنشطة تعليمية متوافقة مع القدرات المعرفية والانفعالية للطلاب",
            "لتقليل وقت الشرح",
            "لزيادة عدد الأنشطة الترفيهية"
        ],
        correct: 1,
        explanation: "التكنولوجيا التعليمية الفعّالة يجب أن تراعي الخصائص النمائية (مثل التفكير المحسوس عند الأطفال)، وإلا فشلت في تحقيق الأهداف التعليمية."
    },
    {
        type: "essay",
        question: "اشرح كيف يُسهم مبدأ \"التكامل في النمو\" في تصميم بيئات تعلم فعّالة باستخدام تكنولوجيا التعليم.",
        modelAnswer: "مبدأ التكامل يشير إلى تداخل الجوانب الجسدية، العقلية، الانفعالية، والاجتماعية في النمو. لذا، عند تصميم بيئات تعلم تكنولوجية، يجب أن تراعي هذا التكامل؛ مثال: استخدام ألعاب تعليمية تفاعلية (تكنولوجيا) لا تُنمّي المهارات المعرفية فحسب، بل تشجّع التعاون (اجتماعي)، وتُقلل القلق (انفعالي)، وتدعم الحركة (جسدي). تجاهل أحد الجوانب قد يُضعف فعالية التعلم، خاصة في المراحل الحرجة مثل الطفولة المبكرة."
    },
    {
        type: "essay",
        question: "لماذا لا يمكن تحقيق هدف \"التدخل في التغيرات السلوكية\" دون وصف دقيق وتفسير سليم؟",
        modelAnswer: "التدخل التربوي أو العلاجي يُعدّ تطبيقًا عمليًا يستند إلى فهم علمي. إذا لم يُوصَف السلوك بدقة (مثل: متى يظهر؟ في أي سياق؟)، أو لم يُفسَّر سببه (وراثي؟ بيئي؟ تفاعلي؟)، فإن التدخل سيكون عشوائيًا وقد يؤدي إلى نتائج عكسية. مثال: معاقبة طفل على \"العدوانية\" دون معرفة أنها رد فعل لحرمان عاطفي (مرحلة فمية عند فرويد) لن يُصلح السلوك بل يُعمّقه."
    },
    {
        type: "essay",
        question: "قارن بين مفهومي \"التمثيل\" و\"التكيّف\" عند بياجي، مع توضيح دور كل منهما في بناء المعرفة.",
        modelAnswer: "التمثيل (Assimilation) هو دمج المعلومات الجديدة ضمن مخططات معرفية قائمة (مثل اعتبار كل حيوان ذي أربع أرجل \"كلبًا\"). أما التكيّف (Accommodation) فهو تعديل المخطط نفسه لاستيعاب معلومات جديدة (مثل تمييز \"القطة\" عن \"الكلب\"). كلا العمليتين ضروريتان: التمثيل يُحافظ على الاستقرار المعرفي، بينما التكيّف يُحدث تغييرًا نوعيًا. التفاعل بينهما يولّد \"التوازن\"، وهو المحرك الأساسي للنمو المعرفي."
    },
    {
        type: "essay",
        question: "كيف تفسّر تأثير \"الفترات الحرجة\" على فعالية البرامج التربوية الرقمية؟",
        modelAnswer: "الفترات الحرجة تمثّل نوافذ زمنية يُظهر فيها الدماغ مرونة عصبية عالية لاستيعاب مهارات محددة (مثل اللغة أو التمييز البصري). البرامج التربوية الرقمية المصممة خارج هذه الفترات (مثل تعليم القراءة لطفل عمره 3 سنوات) قد تكون غير فعّالة أو مرهقة. أما إذا صُمّمت في الوقت المناسب (مثل ألعاب لغوية تفاعلية في مرحلة ما قبل العمليات)، فإنها تستغل الذروة العصبية لتعزيز التعلم بفعالية."
    },
    {
        type: "essay",
        question: "ما العلاقة بين البنية الثلاثية للشخصية عند فرويد وظهور السلوكيات غير المعقولة لدى المراهقين؟",
        modelAnswer: "السلوك غير المعقّل (مثل التمرد العشوائي أو الخجل المفرط) قد ينتج عن اختلال التوازن بين الهو (الرغبات)، الأنا (الواقع)، والأنا العليا (القيم). في المراهقة، تتعارض الرغبات الجنسية (الهو) مع القيم الاجتماعية الصارمة (الأنا العليا)، وإذا كانت الأنا ضعيفة (بسبب تنشئة قمعية)، يفشل الفرد في التوفيق، فيظهر سلوك إما انفعالي (سيطرة الهو) أو مثالي مفرط (سيطرة الأنا العليا)."
    },
    {
        type: "essay",
        question: "لماذا يُعدّ فهم مراحل النمو المعرفي عند بياجي ضروريًا لمصممي الوسائط التعليمية الرقمية؟",
        modelAnswer: "لأن فعالية الوسائط التعليمية تعتمد على توافقها مع القدرات المعرفية للطلاب. فمثلاً، استخدام الرسوم المتحركة المجردة (مثل مفاهيم فيزيائية مجردة) مع تلاميذ في مرحلة ما قبل العمليات (2–7 سنوات) سيكون غير مفهوم، لأن تفكيرهم أناني وغير منطقي. بينما في مرحلة العمليات المحسوسة، يجب استخدام نماذج تفاعلية ملموسة (مثل محاكيات كيميائية بصرية)، أما في العمليات المجردة، فيمكن تقديم مشكلات مفتوحة تتطلب تحليلًا منطقيًا."
    },
    {
        type: "essay",
        question: "كيف يُفسّر علم نفس النمو أهمية احترام الفروق الفردية في معدلات النمو بين الطلاب؟",
        modelAnswer: "علم نفس النمو يؤكد أن النمو ليس خطيًا ولا موحدًا؛ فبينما يتقن طفل القراءة في 5 سنوات، قد لا يفعل آخر حتى 7 سنوات، دون أن يكون ذلك انحرافًا. هذه الفروق ناتجة عن تفاعل الوراثة، البيئة، والنضج. لذا، يجب على المربين تجنّب المقارنات، وتوفير فرص تعلم مرنة (مثل التعلم التكيفي عبر التكنولوجيا) تتناسب مع إيقاع كل طالب، لتجنب الإحباط وتنمية الثقة بالنفس."
    },
    {
        type: "essay",
        question: "ما الدور الذي تلعبه \"البيئة الثقافية\" في تشكيل النمو النفسي-الجنسي عند فرويد في السياق العربي؟",
        modelAnswer: "في المجتمعات العربية، تُقيّد التفاعلات بين الجنسين، وتُركّز التنشئة على القيم المحافظة، مما قد يُعدّل أو يؤخر بعض مظاهر المرحلة التناسلية (مثل الانجذاب للجنس الآخر). كما أن \"عقدة أوديب\" قد تُكبت بشدة، فتظهر لاحقًا كقلق اجتماعي أو صعوبات في تكوين العلاقات. لذا، لا يمكن تطبيق نظرية فرويد بشكل حرفي دون مراعاة السياق الثقافي."
    },
    {
        type: "essay",
        question: "كيف يُمكن ربط مبدأ \"الاستمرارية في النمو\" بفلسفة التعليم مدى الحياة (Lifelong Learning)؟",
        modelAnswer: "مبدأ الاستمرارية يؤكد أن النمو لا يتوقف عند مرحلة معينة، بل يستمر طوال الحياة. هذا يدعم فلسفة التعليم مدى الحياة، التي ترى أن التعلم ليس مقصورًا على المدرسة، بل هو عملية مستمرة تتكيف مع التغيرات المعرفية، الاجتماعية، والمهنية في كل مرحلة (من الطفولة إلى الشيخوخة). التكنولوجيا التعليمية تلعب دورًا محوريًا في تمكين هذا التعلم عبر المنصات الرقمية المرنة."
    },
    {
        type: "essay",
        question: "لماذا يُعدّ التغذية السليمة شرطًا ضروريًا للنمو المعرفي وفقًا لنظرية بياجي؟",
        modelAnswer: "بياجي ربط بين الحالة الفسيولوجية والقدرة المعرفية، إذ أن التمثيل الغذائي السليم يُزوّد الدماغ بالطاقة اللازمة للانتباه، الذاكرة، والمعالجة المعرفية. الطفل الجائع أو المصاب بسوء التغذية يكون تركيزه منخفضًا، مما يُضعف قدرته على التمثيل أو التكيّف المعرفي. لذا، لا يمكن فصل النمو المعرفي عن الجوانب الجسدية، وهو ما يُجسّد مبدأ التكامل في النمو."
    },
    {
        type: "essay",
        question: "ما الفرق بين \"الوصف\" و\"التفسير\" في منهجية علم نفس النمو؟",
        modelAnswer: "الوصف هو رصد وتوثيق الظواهر النمائية كما هي (مثل: \"الطفل في عمر 3 سنوات يستخدم ضمير المتكلم بشكل خاطئ\")، دون تفسير. أما التفسير فهو تحليل الأسباب الكامنة وراء هذه الظاهرة (مثل: \"هذا يعود إلى أن تفكيره أناني ولا يدرك وجهة نظر الآخرين\"). الوصف يسبق التفسير منهجيًا، لأن الفهم الدقيق للظاهرة ضروري قبل الحكم على أسبابها."
    },
    {
        type: "essay",
        question: "كيف تُفسّر تفوّق الإناث في الطلاقة اللغوية مقابل تفوّق الذكور في التفكير المجرد وفقًا لبياجي؟",
        modelAnswer: "رغم أن بياجي لم يركّز على الفروق الجنسية، إلا أن الدراسات اللاحقة أشارت إلى أن العوامل البيولوجية (مثل نضج الفص الصدغي الأيسر عند الإناث مبكرًا) والبيئية (مثل تشجيع الفتيات على التعبير اللفظي) تُسهم في هذا التفاوت. ومع ذلك، فإن هذه الفروق متوسطة وليست مطلقة، ويجب تجنّب التعميمات، خاصة في تصميم المناهج التعليمية."
    },
    {
        type: "essay",
        question: "ما أهمية دراسة مراحل النمو عند المفكرين المسلمين (كابن سينا والغزالي) في السياق التربوي المعاصر؟",
        modelAnswer: "المفكرون المسلمون قدّموا رؤى سبقت عصرهم في تقسيم مراحل النمو (الجنين، الوليد، الطفل...) وربطها بالتنشئة. هذه الرؤى تُثري السياق التربوي العربي المعاصر، لأنها تدمج القيم الإسلامية مع الفهم النمائي، مما يساعد المربين على تصميم برامج تربوية تتناغم مع الهوية الثقافية، بدلًا من استيراد نماذج غربية قد لا تناسب البنية الاجتماعية المحلية."
    },
    {
        type: "essay",
        question: "كيف يُمكن لنظرية فرويد أن تُفسّر ظاهرة \"الخوف من الفشل\" لدى الطلاب المتفوقين؟",
        modelAnswer: "قد يعود هذا الخوف إلى سيطرة الأنا العليا المفرطة، الناتجة عن تنشئة ركّزت على الكمال والعقاب عند الخطأ. في هذه الحالة، يصبح الفشل تهديدًا للهوية الأخلاقية للطالب، وليس مجرد خطأ أكاديمي. الأنا (الوسيط) تكون ضعيفة، فلا تستطيع تهدئة رغبة الهو في الراحة أو قبول الخطأ، مما يولّد قلقًا مزمنًا. العلاج يتطلب تقوية الأنا عبر استراتيجيات تقبل الذات."
    },
    {
        type: "essay",
        question: "لماذا يُعدّ فهم \"الأساليب المعرفية\" (مثل: المستقل عن المجال) مهمًا في تطوير أنظمة التعلم الذكي؟",
        modelAnswer: "الطلاب ذوو الأسلوب المستقل عن المجال يُفضلون التعلم الذاتي والمجرد، بينما المعتمدون على المجال يحتاجون إلى سياقات ملموسة ودعم اجتماعي. أنظمة التعلم الذكي (Adaptive Learning Systems) يمكنها تخصيص المحتوى بناءً على هذا الفهم: تقديم تحديات تحليلية للمستقلين، ونماذج تفاعلية للمعتمدين. هذا يُحقق التعلّم الشخصي الفعّال، وهو هدف جوهري في تكنولوجيا التعليم الحديثة."
    }
];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let score = 0;
        let mcqCount = questions.filter(q => q.type === 'mcq').length;

        function saveProgress() {
            localStorage.setItem('quiz-psychology-d', JSON.stringify({
            currentQuestionIndex, userAnswers, score, mcqCount
            }));
        }

        function loadProgress() {
            const saved = localStorage.getItem('quiz-psychology-d');
            if (saved) {
            const p = JSON.parse(saved);
            currentQuestionIndex = p.currentQuestionIndex;
            userAnswers = p.userAnswers || [];
            score = p.score || 0;
            mcqCount = p.mcqCount || 0;
            document.getElementById('quizContainer').style.display = 'block';
            loadQuestion();
            return true;
            }
            return false;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const root = document.documentElement;
            if (localStorage.getItem('theme') === 'day') {
            root.classList.add('day-mode');
            document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
            }
            document.getElementById('themeToggle').addEventListener('click', () => {
            if (root.classList.contains('day-mode')) {
            root.classList.remove('day-mode');
            localStorage.setItem('theme', 'night');
            document.getElementById('themeToggle').innerHTML = '<i class="fas fa-moon"></i>';
            } else {
            root.classList.add('day-mode');
            localStorage.setItem('theme', 'day');
            document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
            }
            });

            if (!loadProgress()) {
            document.getElementById('quizContainer').style.display = 'block';
            loadQuestion();
            }
        });

        function loadQuestion() {
            saveProgress();
            const q = questions[currentQuestionIndex];
            document.getElementById('questionCounter').textContent = `السؤال ${currentQuestionIndex + 1} من ${questions.length}`;
            document.getElementById('questionText').textContent = q.question;

            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';
            document.getElementById('nextBtn').classList.add('d-none');
            document.getElementById('submitEssayBtn').classList.add('d-none');

            if (q.type === 'mcq') {
            q.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn w-100 text-end';
            btn.textContent = opt;
            btn.onclick = () => selectMCQ(btn, idx);
            container.appendChild(btn);
            });
            if (userAnswers[currentQuestionIndex] !== undefined) {
            const btns = container.querySelectorAll('.option-btn');
            const ans = userAnswers[currentQuestionIndex];
            if (btns[ans]) {
            btns[ans].classList.add('selected');
            showMCQExplanation();
            document.getElementById('nextBtn').classList.remove('d-none');
            }
            }
            } else if (q.type === 'essay') {
            const ta = document.createElement('textarea');
            ta.className = 'essay-input';
            ta.placeholder = 'اكتب إجابتك هنا...';
            if (userAnswers[currentQuestionIndex]) {
            ta.value = userAnswers[currentQuestionIndex];
            }
            container.appendChild(ta);
            document.getElementById('submitEssayBtn').classList.remove('d-none');
            }
        }

        function selectMCQ(btn, idx) {
            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected', 'correct', 'wrong'));
            btn.classList.add('selected');
            userAnswers[currentQuestionIndex] = idx;
            saveProgress();

            const q = questions[currentQuestionIndex];
            if (idx === q.correct) {
            btn.classList.add('correct');
            score++;
            } else {
            btn.classList.add('wrong');
            const correctBtn = container.querySelectorAll('.option-btn')[q.correct];
            if (correctBtn) correctBtn.classList.add('correct');
            }
            showMCQExplanation();
            document.getElementById('nextBtn').classList.remove('d-none');
        }

        function showMCQExplanation() {
            const q = questions[currentQuestionIndex];
            let exp = document.querySelector('.explanation-temp');
            if (!exp) {
            exp = document.createElement('div');
            exp.className = 'explanation explanation-temp';
            exp.innerHTML = `<h5>الشرح:</h5><p>${q.explanation}</p>`;
            document.getElementById('optionsContainer').appendChild(exp);
            }
        }

        function submitEssay() {
            const ta = document.querySelector('.essay-input');
            const ans = ta.value.trim();
            if (!ans) { alert('يرجى كتابة إجابة.'); return; }
            userAnswers[currentQuestionIndex] = ans;
            saveProgress();

            document.getElementById('submitEssayBtn').classList.add('d-none');

            const q = questions[currentQuestionIndex];
            const exp = document.createElement('div');
            exp.className = 'explanation';
            exp.innerHTML = `<h5>الإجابة النموذجية:</h5><p>${q.modelAnswer}</p>`;
            document.getElementById('optionsContainer').appendChild(exp);

            document.getElementById('nextBtn').classList.remove('d-none');
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
            loadQuestion();
            } else {
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('finalFormContainer').style.display = 'block';
            }
        }

        function saveStudentData() {
            const name = document.getElementById('studentName').value.trim();
            const id = document.getElementById('studentId').value.trim();
            if (!name || !id) { alert('أدخل الاسم وال ID.'); return; }

            const data = {
            studentName: name,
            studentId: id,
            subjectName: "علم نفس النمو",
            section: "د",
            score: score,
            totalMCQ: mcqCount,
            percentage: mcqCount ? Math.round((score / mcqCount) * 100) : 0,
            timestamp: new Date().toISOString(),
            answers: userAnswers.map((a, i) => ({
            question: questions[i].question,
            type: questions[i].type,
            userAnswer: a,
            correctAnswer: questions[i].type === 'mcq' ? questions[i].options[questions[i].correct] : null,
            explanation: questions[i].type === 'mcq' ? questions[i].explanation : questions[i].modelAnswer
            }))
            };

            if (window.saveToFirebase) window.saveToFirebase(data);

            localStorage.removeItem('quiz-psychology-d');
            showFinalResults(name, id, data.percentage);
        }

        function showFinalResults(name, id, pct) {
            document.getElementById('finalFormContainer').style.display = 'none';
            document.getElementById('resultContainer').style.display = 'block';

            document.getElementById('finalScore').textContent = `${score}/${mcqCount}`;
            let txt = "حاول مرة أخرى! 💪";
            if (pct >= 80) txt = "ممتاز! 🌟";
            else if (pct >= 60) txt = "جيد جدًا! 👍";
            else if (pct >= 40) txt = "لابأس! 📚";
            document.getElementById('resultText').textContent = txt;

            const expCont = document.getElementById('explanationsContainer');
            expCont.innerHTML = '<h3 class="text-light mb-4">جميع إجاباتك:</h3>';
            questions.forEach((q, i) => {
            const div = document.createElement('div');
            div.className = 'explanation';
            const userAns = userAnswers[i] || "لم تجب";
            if (q.type === 'mcq') {
            div.innerHTML = `
            <h5>السؤال ${i+1}: ${q.question}</h5>
            <p><strong>إجابتك:</strong> ${q.options[userAns] || 'لم تجب'}</p>
            <p><strong>الإجابة الصحيحة:</strong> ${q.options[q.correct]}</p>
            <p><strong>الشرح:</strong> ${q.explanation}</p>
            `;
            } else {
            div.innerHTML = `
            <h5>السؤال ${i+1} (مقالي): ${q.question}</h5>
            <p><strong>إجابتك:</strong> ${userAns}</p>
            <p><strong>الإجابة النموذجية:</strong> ${q.modelAnswer}</p>
            `;
            }
            expCont.appendChild(div);
            });
        }

        function shareToWhatsApp() {
            const cc = document.getElementById('countryCode').value.trim();
            const phone = document.getElementById('phoneNumber').value.trim();
            if (!cc || !phone) { alert('أدخل رمز الدولة ورقم الهاتف.'); return; }
            const full = cc + phone.replace(/^0+/, '');
            const msg = `لقد انتهيت من اختبار "علم نفس النمو - المجموعة د" وحصلت على ${score}/${mcqCount}!`;
            window.open(`https://wa.me/${full}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFont('Amiri');
            doc.text('نتائج الاختبار', 105, 20, null, null, 'center');
            doc.text('علم نفس النمو - المجموعة د', 20, 40);
            doc.text(`النتيجة: ${score}/${mcqCount}`, 20, 50);
            let y = 70;
            questions.forEach((q, i) => {
            if (y > 250) { doc.addPage(); y = 20; }
            doc.text(`السؤال ${i+1}: ${q.question}`, 20, y);
            y += 10;
            const ans = userAnswers[i] || 'لم تجب';
            if (q.type === 'mcq') {
            doc.text(`إجابتك: ${q.options[ans] || 'لم تجب'}`, 25, y);
            y += 10;
            doc.text(`الصحيحة: ${q.options[q.correct]}`, 25, y);
            } else {
            doc.text(`إجابتك: ${ans}`, 25, y);
            }
            y += 15;
            });
            doc.save('نتيجة_علم_نفس_النمو_د.pdf');
        }

        function restartQuiz() {
            localStorage.removeItem('quiz-psychology-d');
            currentQuestionIndex = 0; userAnswers = []; score = 0;
            document.getElementById('resultContainer').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'block';
            loadQuestion();
        }

        function backToMaterials() {
            localStorage.removeItem('quiz-psychology-d');
            window.location.href = 'materials.html';
        }

        function exitQuiz() {
            if (confirm('هل تريد إنهاء الاختبار؟')) {
            localStorage.removeItem('quiz-psychology-d');
            window.location.href = 'materials.html';
            }
        }
        </script>
</body>
</html>