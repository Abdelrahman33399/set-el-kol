<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <link rel="icon" href="../../Image_fx6.jpg" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الاختبار - شبكات</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: rgba(255, 255, 255, 0.05);
            --border-color: rgba(255, 255, 255, 0.1);
            --text-light: #e0e0e0;
            --primary-neon: linear-gradient(45deg, #a453ff, #54aaff);
            --accent-orange: #ff6b35;
        }
        .day-mode {
            --bg-color: #1b405f;
            --card-bg: rgba(255, 255, 255, 0.7);
            --text-light: #ec6211;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s;
        }
        .quiz-container, .final-form, .result-container {
            display: none;
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 20px;
            margin: 2rem auto;
            max-width: 800px;
            border: 1px solid var(--border-color);
        }
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .question-counter {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--accent-orange);
        }
        .question-text {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            color: var(--text-light);
            font-weight: 600;
        }
        .options-container {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .option-btn {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #ddd;
            padding: 1rem;
            border-radius: 12px;
            text-align: right;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.1rem;
        }
        .option-btn:hover {
            background: rgba(255, 107, 53, 0.2);
            color: var(--text-light);
        }
        .option-btn.selected {
            background: var(--accent-orange);
            color: white;
            transform: scale(1.02);
        }
        .option-btn.correct {
            background: #28a745;
            color: white;
        }
        .option-btn.wrong {
            background: #dc3545;
            color: white;
        }
        .essay-input {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            font-size: 1.1rem;
            resize: vertical;
            margin-bottom: 1.5rem;
        }
        .quiz-btns {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        .quiz-btn {
            padding: 12px 30px;
            border-radius: 30px;
            font-weight: 600;
            transition: all 0.3s;
            white-space: nowrap;
        }
        .next-btn, .submit-btn {
            background: var(--accent-orange);
            color: white;
        }
        .next-btn:hover, .submit-btn:hover {
            background: #e05a2a;
        }
        .restart-btn {
            background: #6c757d;
            color: white;
        }
        .back-btn {
            background: #28a745;
            color: white;
        }
        .result-score {
            font-size: 3rem;
            font-weight: 800;
            background: var(--primary-neon);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 1rem 0;
        }
        .result-text {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            color: var(--text-light);
        }
        .explanation {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            text-align: right;
            border-right: 4px solid var(--accent-orange);
        }
        .explanation h5 {
            color: var(--accent-orange);
            margin-bottom: 0.5rem;
        }
        .final-form input {
            width: 100%;
            padding: 12px;
            margin: 0.5rem 0;
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            font-size: 1.1rem;
        }
        .theme-toggle-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--accent-orange);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 1000;
        }
        .back-to-home-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--accent-orange);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <button id="themeToggle" class="theme-toggle-btn">
        <i class="fas fa-moon"></i>
    </button>

    <div class="container py-5">
        <div id="quizContainer" class="quiz-container">
            <div class="quiz-header">
                <div class="question-counter" id="questionCounter">السؤال 1 من 2</div>
                <button class="btn btn-outline-light" onclick="exitQuiz()">
                    <i class="fas fa-times"></i> إنهاء
                </button>
            </div>
            <div class="question-text" id="questionText">نص السؤال هنا...</div>
            <div class="options-container" id="optionsContainer"></div>
            <div class="quiz-btns">
                <button class="quiz-btn next-btn d-none" id="nextBtn" onclick="nextQuestion()">التالي</button>
                <button class="quiz-btn submit-btn d-none" id="submitEssayBtn" onclick="submitEssay()">تسليم</button>
            </div>
        </div>

        <div id="finalFormContainer" class="final-form">
            <h3 class="text-center mb-4">أدخل بياناتك</h3>
            <input type="text" id="studentName" placeholder="الاسم الكامل" required>
            <input type="text" id="studentId" placeholder=" (ID)" required>
            <div class="quiz-btns mt-3">
                <button class="quiz-btn next-btn" onclick="saveStudentData()">حفظ</button>
            </div>
        </div>

        <div id="resultContainer" class="result-container">
            <h2>🎉 انتهيت من الاختبار!</h2>
            <div class="result-score" id="finalScore">0/2</div>
            <div class="result-text" id="resultText">أحسنت! واصل التميز 🌟</div>
            <div id="explanationsContainer"></div>
            <div class="mt-4">
                <h4>شارك نتيجتك أو احفظها</h4>
                <div class="input-group mb-3">
                    <span class="input-group-text">+<input type="text" id="countryCode" placeholder="رمز الدولة" style="max-width:80px; text-align:center;" value="20"></span>
                    <input type="text" id="phoneNumber" class="form-control" placeholder="رقم الهاتف (بدون صفر)">
                </div>
                <div class="quiz-btns">
                    <button class="quiz-btn back-btn" onclick="shareToWhatsApp()">
                        <i class="fab fa-whatsapp"></i> إرسال عبر واتساب
                    </button>
                    <button class="quiz-btn next-btn" onclick="downloadPDF()">
                        <i class="fas fa-file-pdf"></i> تحميل كـ PDF
                    </button>
                    <button class="quiz-btn restart-btn" onclick="restartQuiz()">
                        <i class="fas fa-redo"></i> إعادة الاختبار
                    </button>
                    <button class="quiz-btn back-btn" onclick="backToMaterials()">
                        <i class="fas fa-list"></i> العودة للمواد
                    </button>
                </div>
            </div>
        </div>

        <a href="materials.html" class="back-to-home-btn">
            <i class="fas fa-arrow-left me-2"></i> العودة للمواد
        </a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDeapYypO595vcDWUoh1gOncsGkQ5EZdyE",
            authDomain: "sit-el-kol.firebaseapp.com",
            projectId: "sit-el-kol",
            storageBucket: "sit-el-kol.firebasestorage.app",
            messagingSenderId: "573924344198",
            appId: "1:573924344198:web:fec2e9a54c1c152cd16c07"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.saveToFirebase = async function(data) {
            try {
                await addDoc(collection(db, "quiz_submissions"), data);
            } catch (e) {
                console.error("فشل حفظ البيانات:", e);
            }
        };
    </script>

    <script>
       const questions = [
    {
        type: "mcq",
        question: "أي من الطبقات التالية لا تعمل عليها الشبكات الواسعة (WAN) وفق نموذج OSI؟",
        options: [
            "الطبقة الفيزيائية",
            "طبقة ربط البيانات",
            "طبقة الشبكة",
            "طبقة الجلسة"
        ],
        correct: 3,
        explanation: "الشبكات الواسعة تركز على الطبقات الثلاث السفلى (الفيزيائية، ربط البيانات، الشبكة) لأنها مسؤولة عن نقل البيانات عبر مسافات طويلة. طبقة الجلسة (الخامسة) تُدار عادةً في الأنظمة الطرفية، وليس في البنية التحتية لـ WAN."
    },
    {
        type: "mcq",
        question: "ما الفرق الجوهري بين \"تبديل الدوائر\" و\"تبديل الحزم\"؟",
        options: [
            "تبديل الدوائر أسرع دائمًا",
            "تبديل الدوائر ينشئ اتصالًا مخصصًا مؤقتًا، بينما تبديل الحزم يُشارك النطاق بين مستخدمين",
            "تبديل الحزم لا يُستخدم في الإنترنت",
            "تبديل الدوائر يعتمد على IP"
        ],
        correct: 1,
        explanation: "في تبديل الدوائر (مثل المكالمات الهاتفية القديمة)، يُخصص مسار كامل للمستخدم طوال المكالمة. أما في تبديل الحزم (مثل الإنترنت)، تُقسّم البيانات إلى حزم تُرسل عبر مسارات مختلفة، مما يُحسّن كفاءة استخدام النطاق ويقلل التكلفة."
    },
    {
        type: "mcq",
        question: "ما وظيفة وحدة CSU/DSU في شبكات WAN؟",
        options: [
            "تحويل الإشارات الرقمية إلى تماثلية",
            "توفير واجهة بين الموجّه والدائرة الرقمية المؤجرة",
            "إدارة عناوين IP تلقائيًا",
            "تشفير البيانات أثناء النقل"
        ],
        correct: 1,
        explanation: "CSU/DSU (Channel Service Unit / Data Service Unit) هي واجهة رقمية تُستخدم لتوصيل جهاز التوجيه (Router) بالدوائر الرقمية (مثل T1/E1)، وتعمل كنقطة اتصال بين معدات العميل ومعدات مزود الخدمة."
    },
    {
        type: "mcq",
        question: "أي من العبارات التالية صحيحة عن \"الدوائر الافتراضية\"؟",
        options: [
            "هي دوائر فيزيائية دائمة",
            "تُنشأ منطقيًا داخل الشبكة وتُلغى عند انتهاء الجلسة",
            "لا تُستخدم في X.25",
            "تضمن سرعة ثابتة دائمًا"
        ],
        correct: 1,
        explanation: "الدوائر الافتراضية (Virtual Circuits) هي اتصالات منطقية تُنشأ عبر شبكة تبديل الحزم (مثل X.25 أو Frame Relay) لربط طرفين مؤقتًا، وتُزال بعد انتهاء الجلسة، مما يوفر مرونة وكفاءة."
    },
    {
        type: "mcq",
        question: "ما الفرق بين العناوين الفيزيائية (MAC) والعناوين المنطقية (IP)؟",
        options: [
            "MAC يُستخدم على طبقة الشبكة، وIP على طبقة ربط البيانات",
            "MAC ثابت ومُخزن في الجهاز، وIP يمكن أن يتغير حسب الشبكة",
            "كلاهما يُستخدمان فقط في الشبكات المحلية",
            "IP مكوّن من 48 بت"
        ],
        correct: 1,
        explanation: "عنوان MAC (48 بت) فريد وثابت لكل واجهة شبكية، ومُخزن في العتاد. أما عنوان IP فهو منطقي وقابل للتغيير، ويُخصص حسب الشبكة التي يتصل بها الجهاز، وقد يكون ثابتًا أو ديناميكيًا."
    },
    {
        type: "mcq",
        question: "أي من البروتوكولات التالية يُستخدم لترجمة عنوان IP إلى عنوان MAC؟",
        options: [
            "RARP",
            "ICMP",
            "ARP",
            "OSPF"
        ],
        correct: 2,
        explanation: "بروتوكول ARP (Address Resolution Protocol) يُرسل طلبًا على الشبكة المحلية لتحديد العنوان الفيزيائي (MAC) المقابل لعنوان IP معين، وهو ضروري لإرسال الحزم داخل نفس الشبكة."
    },
    {
        type: "mcq",
        question: "ما الهدف من \"التجميع الإحصائي\" (Statistical Multiplexing) في Frame Relay؟",
        options: [
            "تخصيص سعة ثابتة لكل قناة",
            "تحسين كفاءة استخدام النطاق عبر تخصيص السعة ديناميكيًا للقنوات النشطة",
            "تقليل سرعة النقل",
            "منع التداخل بين القنوات"
        ],
        correct: 1,
        explanation: "التجميع الإحصائي يسمح بتخصيص عرض النطاق فقط للقنوات التي لديها بيانات للإرسال، مما يزيد الكفاءة مقارنة بالتخصيص الثابت (مثل TDM)، خاصة في الشبكات ذات الاستخدام المتقطع."
    },
    {
        type: "mcq",
        question: "أي من العبارات التالية تُعبّر عن مبدأ \"الإرسال نهاية-نهاية\" في معمارية الإنترنت؟",
        options: [
            "يجب تأمين البيانات في كل نقطة وسطية",
            "يجب معالجة الأخطاء والاعتمادية عند أطراف الشبكة (المُرسل والمستقبل)",
            "الشبكة مسؤولة عن ترتيب الحزم",
            "يجب استخدام جدران نارية في كل موجّه"
        ],
        correct: 1,
        explanation: "مبدأ الإرسال نهاية-نهاية يفترض أن الشبكة نفسها بسيطة وغير مسؤولة عن الاعتمادية أو الأمان، بل تُترك هذه المهام للأنظمة الطرفية (مثل استخدام TCP أو IPsec في الأجهزة النهائية)."
    },
    {
        type: "mcq",
        question: "ما الفرق بين TCP وUDP؟",
        options: [
            "TCP غير اعتمادي، وUDP اعتمادي",
            "TCP يُستخدم للوسائط المتعددة، وUDP للبريد",
            "TCP يضمن التسليم والترتيب، وUDP لا يضمن أيًا منهما",
            "UDP أبطأ من TCP"
        ],
        correct: 2,
        explanation: "TCP يُنشئ اتصالًا موثوقًا، ويضمن تسليم الحزم بترتيبها، مع إعادة الإرسال عند الفقد. أما UDP فهو أسرع، لكنه غير اعتمادي، ويُستخدم في التطبيقات التي تتحمل بعض الفقد (مثل البث الحي أو الألعاب)."
    },
    {
        type: "mcq",
        question: "ما وظيفة بروتوكول OSPF؟",
        options: [
            "نقل الملفات",
            "توجيه الحزم داخل نظام مستقل باستخدام معلومات حالة الوصلات",
            "تحليل العناوين الفيزيائية",
            "إدارة عناوين البريد الإلكتروني"
        ],
        correct: 1,
        explanation: "OSPF (Open Shortest Path First) هو بروتوكول توجيه من نوع Link State، يُستخدم في الشبكات الكبيرة لتحديد أقصر مسار بناءً على حالة جميع الوصلات في الشبكة، ويُحدّث جداول التوجيه فورًا عند حدوث تغيير."
    },
    {
        type: "mcq",
        question: "ما الهدف من نظام أسماء النطاقات (DNS)؟",
        options: [
            "تشفير عناوين IP",
            "ترجمة أسماء النطاقات إلى عناوين IP بطريقة هرمية",
            "منع الهجمات الإلكترونية",
            "توزيع الحزم عبر الشبكة"
        ],
        correct: 1,
        explanation: "DNS يُسهّل على البشر استخدام الإنترنت عبر استبدال العناوين الرقمية (IP) بأسماء سهلة التذكّر (مثل google.com)، ويستخدم بنية هرمية (جذور → TLD → نطاق فرعي) لحل الأسماء بكفاءة."
    },
    {
        type: "mcq",
        question: "أي من العبارات التالية صحيحة عن IPv6؟",
        options: [
            "يحتوي على 32 بت فقط",
            "متوافق تمامًا مع IPv4",
            "يوفر ≈3.4×10³⁸ عنوانًا",
            "لا يدعم التشفير"
        ],
        correct: 2,
        explanation: "IPv6 يستخدم عناوين بطول 128 بت، مما يوفّر عددًا هائلاً من العناوين لدعم إنترنت الأشياء (IoT). وهو غير متوافق مع IPv4، لذا يُستخدم تقنيات مثل Tunneling للانتقال التدريجي."
    },
    {
        type: "mcq",
        question: "ما الفرق بين \"المسالك الساكنة\" و\"الديناميكية\"؟",
        options: [
            "الساكنة تُحدّث تلقائيًا، والديناميكية يدوية",
            "الساكنة تُدخل يدويًا لأسباب أمنية أو بساطة، والديناميكية تتكيف مع تغيّر الشبكة",
            "الديناميكية لا تُستخدم في الشبكات الكبيرة",
            "الساكنة أسرع دائمًا"
        ],
        correct: 1,
        explanation: "المسالك الساكنة (Static Routes) تُحدّدها إدارة الشبكة يدويًا، وتُستخدم في الشبكات الصغيرة أو لأغراض أمنية. أما الديناميكية فتُحدّث تلقائيًا عبر بروتوكولات مثل OSPF أو RIP، مما يجعلها مناسبة للشبكات المعقدة."
    },
    {
        type: "mcq",
        question: "ما وظيفة بروتوكول ICMP؟",
        options: [
            "نقل الملفات",
            "إرسال رسائل خطأ وحالة الشبكة (مثل \"الجهاز غير قابل للوصول\")",
            "تشفير البيانات",
            "إدارة عناوين MAC"
        ],
        correct: 1,
        explanation: "ICMP (Internet Control Message Protocol) لا ينقل بيانات المستخدم، بل يُستخدم من قبل الأجهزة الشبكية لإبلاغ الأخطاء (مثل Time Exceeded أو Destination Unreachable)، وهو أساسي لأدوات مثل Ping وTraceroute."
    },
    {
        type: "mcq",
        question: "لماذا يُعتبر \"التشبيك الشبكي\" (Spine Networking) حلاً لمشكلة التوسع؟",
        options: [
            "لأنه يقلل عدد الأجهزة",
            "لأنه يعتمد على تكرار المكونات ودعم مركزي لإدارة الشبكة",
            "لأنه يلغي الحاجة إلى الموجّهات",
            "لأنه يستخدم فقط تقنيات LAN"
        ],
        correct: 1,
        explanation: "التشبيك الشبكي يعالج تحديات الاعتمادية والتوسع عبر تكرار المكونات (لضمان الاستمرارية عند الفشل) والإدارة المركزية (لتبسيط التحكم)، مما يجعل البنية التحتية أكثر مرونة وكفاءة."
    },
    {
        type: "essay",
        question: "اشرح كيف تُسهم تقنيات تبديل الحزم (مثل Frame Relay) في تقليل تكلفة الشبكات الواسعة مقارنةً بالدوائر المؤجرة.",
        modelAnswer: "الدوائر المؤجرة توفر اتصالًا دائمًا بسعة مخصصة، حتى لو لم تُستخدم، مما يولّد هدرًا ماليًا. أما تقنيات تبديل الحزم (مثل Frame Relay) فتعتمد على المشاركة الديناميكية للنطاق بين عدة مستخدمين، حيث تُخصص السعة فقط عند الحاجة الفعلية للإرسال. هذا النموذج \"حسب الاستخدام\" يقلل التكلفة التشغيلية، خاصة للشركات ذات حركة مرور غير منتظمة، مع الحفاظ على جودة خدمة مقبولة عبر آليات مثل CIR (Committed Information Rate)."
    },
    {
        type: "essay",
        question: "لماذا يُعدّ فهم الفرق بين العناوين الفيزيائية (MAC) والمنطقية (IP) ضروريًا لمهندسي الشبكات؟",
        modelAnswer: "لأن كل عنوان يلعب دورًا في طبقة مختلفة من نموذج OSI. عنوان MAC يُستخدم للتوصيل داخل نفس الشبكة المحلية (طبقة ربط البيانات)، بينما عنوان IP يُستخدم لتوجيه الحزم عبر شبكات متعددة (طبقة الشبكة). الخلط بينهما يؤدي إلى أخطاء في التصميم (مثل محاولة توجيه حزم بناءً على MAC عبر الإنترنت). كما أن فهم ARP وRARP ضروري لتشخيص مشكلات الاتصال داخل الشبكة المحلية."
    },
    {
        type: "essay",
        question: "كيف يُفسّر مبدأ \"الصلابة\" (Robustness Principle) سلوك بروتوكولات الإنترنت في التعامل مع التنوع التكنولوجي؟",
        modelAnswer: "ينص مبدأ الصلابة على أن المرسل يجب أن يكون دقيقًا جدًا في تنسيق بياناته، بينما المستقبل يجب أن يكون متسامحًا في قبول البيانات (حتى لو كانت غير مثالية). هذا يسمح لأنظمة متنوعة (من شركات وتقنيات مختلفة) بالاتصال عبر الإنترنت دون فشل بسبب اختلافات طفيفة في التنفيذ، مما يعزز التوافقية والانتشار العالمي للبروتوكول."
    },
    {
        type: "essay",
        question: "ما العلاقة بين \"التجميع الإحصائي\" و\"كفاءة استخدام النطاق\" في شبكات WAN الحديثة؟",
        modelAnswer: "التجميع الإحصائي يُحسّن الكفاءة عبر استغلال عدم التزامن في استخدام القنوات. فبينما قد تكون بعض القنوات خاملة، تكون أخرى نشطة. بدلًا من تخصيص سعة ثابتة لكل قناة (كما في TDM)، يُخصص النظام السعة ديناميكيًا للقنوات النشطة فقط. هذا يقلل الهدر، ويزيد عدد المستخدمين الذين يمكن دعمهم على نفس البنية التحتية، وهو أساس تقنيات مثل Frame Relay وATM."
    },
    {
        type: "essay",
        question: "لماذا يُعدّ بروتوكول X.25 أقل كفاءة من Frame Relay في الشبكات الحديثة؟",
        modelAnswer: "لأن X.25 يُجري التحقق من الأخطاء وإعادة الإرسال على كل قفزة (hop-by-hop) عبر الشبكة، مما يولّد تأخيرًا كبيرًا ويقلل السرعة. أما Frame Relay، فيفترض أن الشبكة الحديثة (خاصة الرقمية) أقل عرضة للأخطاء، لذا يُجري التحقق فقط عند الطرفين (end-to-end)، مما يقلل التحميل على العقد الوسيطة ويزيد الكفاءة، خاصة في الشبكات عالية السرعة."
    },
    {
        type: "essay",
        question: "كيف يُسهم نظام DNS في تحقيق التوسع والاعتمادية في الإنترنت؟",
        modelAnswer: "DNS يستخدم بنية هرمية ولا مركزية، حيث تُوزّع قواعد البيانات عبر خوادم جذور، TLD، وخوادم نطاقات فرعية. هذا يمنع اختناقات الأداء، ويسمح بإضافة نطاقات جديدة بسهولة. كما أن التكرار (Replication) بين خوادم DNS يضمن الاعتمادية؛ فحتى لو تعطّل خادم، يمكن لغيره تلبية الطلب. هذه الميزات جعلت DNS قادرًا على دعم مليارات الأجهزة حول العالم."
    },
    {
        type: "essay",
        question: "ما الفرق بين بروتوكولي التوجيه RIP وOSPF من حيث آلية العمل والكفاءة؟",
        modelAnswer: "RIP (من نوع Distance Vector) يحسب \"المسافة\" إلى الهدف بعدد القفزات، ولا يعرف تفاصيل الشبكة، ويُحدّث جداوله دوريًا (كل 30 ثانية)، مما يؤدي إلى تأخير في التكيّف مع التغييرات. أما OSPF (من نوع Link State) فيبني \"خريطة كاملة\" للشبكة، ويُحدّثها فورًا عند أي تغيير، مما يجعله أسرع وأكثر كفاءة في الشبكات الكبيرة والمعقدة، رغم تعقيده الأعلى."
    },
    {
        type: "essay",
        question: "لماذا يُعتبر IPsec ضروريًا في عصر إنترنت الأشياء (IoT)؟",
        modelAnswer: "لأن إنترنت الأشياء يربط مليارات الأجهزة (الكثير منها ضعيف أمنيًا) عبر الإنترنت، مما يزيد من نقاط الاختراق. IPsec يوفّر أمانًا على مستوى طبقة الشبكة عبر التشفير، توثيق الهوية، وضمان سلامة البيانات، مما يحمي الاتصالات حتى لو لم تدعم التطبيقات طبقات أمان أعلى. هذا يجعله حلاً شاملاً ومناسبًا للأجهزة المحدودة الموارد."
    },
    {
        type: "essay",
        question: "كيف يُمكن لتقنية Tunneling أن تُسهّل الانتقال من IPv4 إلى IPv6؟",
        modelAnswer: "Tunneling تسمح بـ تغليف حزم IPv6 داخل حزم IPv4 (أو العكس) لنقلها عبر شبكات لا تدعم البروتوكول الجديد. مثلاً، عند إرسال بيانات من شبكة IPv6 عبر شبكة IPv4، يُنشئ الجهاز الطرفي \"نفقًا\" يُدخل فيه حزمة IPv6 كحمولة داخل حزمة IPv4. عند الوصول إلى شبكة IPv6، تُزال الحزمة الخارجية. هذا يسمح بالانتقال التدريجي دون الحاجة إلى تحديث البنية التحتية دفعة واحدة."
    },
    {
        type: "essay",
        question: "ما العلاقة بين \"التحكم في التدفق\" و\"الشباك المنزلق\" في بروتوكول TCP؟",
        modelAnswer: "الشباك المنزلق (Sliding Window) هو آلية ديناميكية للتحكم في التدفق في TCP. بدلًا من إرسال حزمة واحدة وانتظار التأكيد، يسمح المرسل بإرسال مجموعة من الحزم (بحسب حجم النافذة)، ثم ينتظر تأكيدات جماعية. إذا تأخر التأكيد، يُقلّل حجم النافذة (لتجنب الاختناق). هذه الآلية توازن بين الكفاءة (الإرسال المتواصل) والاعتمادية (التحكم في الفقد)."
    },
    {
        type: "essay",
        question: "لماذا يُستخدم FTP وصلتين منفصلتين (بيانات + تحكم)؟",
        modelAnswer: "لأن فصل قناة التحكم (لإرسال الأوامر مثل LIST أو RETR) عن قناة البيانات (لنقل الملفات) يُحسّن المرونة والأمان. فمثلاً، يمكن إرسال أوامر التحكم عبر اتصال مشفر (FTPS)، بينما تُرسل البيانات عبر قناة منفصلة. كما أن الفصل يسمح باستمرار جلسة التحكم حتى أثناء نقل ملف كبير، مما يمنع انقطاع الاتصال."
    },
    {
        type: "essay",
        question: "كيف يُسهم \"التوجيه الديناميكي\" في مواجهة هجمات الحرمان من الخدمة (DoS)؟",
        modelAnswer: "في هجمات DoS، قد يتم تعطيل مسار معين عبر إغراقه بالحزم. التوجيه الديناميكي (مثل OSPF) يكتشف فشل المسار تلقائيًا، ويُعيد توجيه الحزم عبر مسارات بديلة خلال ثوانٍ، مما يحافظ على استمرارية الخدمة. هذا يفوق التوجيه الساكن، الذي يتطلب تدخلًا يدويًا لإعادة التوجيه، مما يطيل وقت التوقف."
    },
    {
        type: "essay",
        question: "ما الفرق بين POP3 وIMAP في إدارة البريد الإلكتروني؟",
        modelAnswer: "POP3 يحمّل الرسائل من الخادم إلى الجهاز المحلي ثم يحذفها (عادةً)، مما يجعلها غير متاحة من أجهزة أخرى. أما IMAP فيُبقي الرسائل على الخادم، ويُزامن الحالة (مقروءة/غير مقروءة) عبر جميع الأجهزة. لذا، POP3 مناسب لمستخدم جهاز واحد، بينما IMAP أفضل للمستخدمين المتعددي الأجهزة، رغم احتياجاته الأعلى من النطاق والتخزين."
    },
    {
        type: "essay",
        question: "لماذا يُعتبر SCTP بروتوكولًا مثاليًا لنقل إشارات الاتصالات (مثل في شبكات الهاتف المحمول)؟",
        modelAnswer: "لأن SCTP يجمع بين مزايا TCP (الاعتمادية، الترتيب، التحكم في الاختناق) ومزايا UDP (الاتصال متعدد التدفقات – Multi-homing). في شبكات الاتصالات، قد يفشل اتصال عبر واجهة شبكة واحدة، لكن SCTP يمكنه التبديل فورًا إلى واجهة بديلة دون انقطاع، مما يضمن استمرارية الإشارة الحساسة للزمن، وهو أمر حاسم في أنظمة مثل VoLTE أو 5G."
    },
    {
        type: "essay",
        question: "كيف تُفسّر الحاجة إلى جدران الحماية (Firewalls) كـ \"استثناء\" من مبدأ الإرسال نهاية-نهاية؟",
        modelAnswer: "مبدأ الإرسال نهاية-نهاية يفترض أن الشبكة \"غبية\" ولا تتدخل في المحتوى. لكن مع انتشار الهجمات الإلكترونية، أصبح من الضروري فحص الحزم في نقاط وسيطة (مثل جدران الحماية) لمنع البرمجيات الخبيثة أو الاختراقات. هذا يُعدّ \"خرقًا\" للمبدأ الأصلي، لكنه ضرورة أمنية في العصر الحديث، حيث لم تعد الأطراف وحدها كافية لضمان الأمان."
    }
];

        let currentQuestionIndex = 0;
        let userAnswers = [];
        let score = 0;
        let mcqCount = questions.filter(q => q.type === 'mcq').length;

        function saveProgress() {
            localStorage.setItem('quiz-networks-b', JSON.stringify({
            currentQuestionIndex, userAnswers, score, mcqCount
            }));
        }

        function loadProgress() {
            const saved = localStorage.getItem('quiz-networks-b');
            if (saved) {
            const p = JSON.parse(saved);
            currentQuestionIndex = p.currentQuestionIndex;
            userAnswers = p.userAnswers || [];
            score = p.score || 0;
            mcqCount = p.mcqCount || 0;
            document.getElementById('quizContainer').style.display = 'block';
            loadQuestion();
            return true;
            }
            return false;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const root = document.documentElement;
            if (localStorage.getItem('theme') === 'day') {
            root.classList.add('day-mode');
            document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
            }
            document.getElementById('themeToggle').addEventListener('click', () => {
            if (root.classList.contains('day-mode')) {
                root.classList.remove('day-mode');
                localStorage.setItem('theme', 'night');
                document.getElementById('themeToggle').innerHTML = '<i class="fas fa-moon"></i>';
            } else {
                root.classList.add('day-mode');
                localStorage.setItem('theme', 'day');
                document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
            }
            });

            if (!loadProgress()) {
            document.getElementById('quizContainer').style.display = 'block';
            loadQuestion();
            }
        });

        function loadQuestion() {
            saveProgress();
            const q = questions[currentQuestionIndex];
            document.getElementById('questionCounter').textContent = `السؤال ${currentQuestionIndex + 1} من ${questions.length}`;
            document.getElementById('questionText').textContent = q.question;

            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';
            document.getElementById('nextBtn').classList.add('d-none');
            document.getElementById('submitEssayBtn').classList.add('d-none');

            if (q.type === 'mcq') {
            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn w-100 text-end';
                btn.textContent = opt;
                btn.onclick = () => selectMCQ(btn, idx);
                container.appendChild(btn);
            });
            if (userAnswers[currentQuestionIndex] !== undefined) {
                const btns = container.querySelectorAll('.option-btn');
                const ans = userAnswers[currentQuestionIndex];
                if (btns[ans]) {
                btns[ans].classList.add('selected');
                showMCQExplanation();
                document.getElementById('nextBtn').classList.remove('d-none');
                }
            }
            } else if (q.type === 'essay') {
            const ta = document.createElement('textarea');
            ta.className = 'essay-input';
            ta.placeholder = 'اكتب إجابتك هنا...';
            if (userAnswers[currentQuestionIndex]) {
                ta.value = userAnswers[currentQuestionIndex];
            }
            container.appendChild(ta);
            document.getElementById('submitEssayBtn').classList.remove('d-none');
            }
        }

        function selectMCQ(btn, idx) {
            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected', 'correct', 'wrong'));
            btn.classList.add('selected');
            userAnswers[currentQuestionIndex] = idx;
            saveProgress();

            const q = questions[currentQuestionIndex];
            if (idx === q.correct) {
            btn.classList.add('correct');
            score++;
            } else {
            btn.classList.add('wrong');
            const correctBtn = container.querySelectorAll('.option-btn')[q.correct];
            if (correctBtn) correctBtn.classList.add('correct');
            }
            showMCQExplanation();
            document.getElementById('nextBtn').classList.remove('d-none');
        }

        function showMCQExplanation() {
            const q = questions[currentQuestionIndex];
            let exp = document.querySelector('.explanation-temp');
            if (!exp) {
            exp = document.createElement('div');
            exp.className = 'explanation explanation-temp';
            exp.innerHTML = `<h5>الشرح:</h5><p>${q.explanation}</p>`;
            document.getElementById('optionsContainer').appendChild(exp);
            }
        }

        function submitEssay() {
            const ta = document.querySelector('.essay-input');
            const ans = ta.value.trim();
            if (!ans) { alert('يرجى كتابة إجابة.'); return; }
            userAnswers[currentQuestionIndex] = ans;
            saveProgress();

            document.getElementById('submitEssayBtn').classList.add('d-none');

            const q = questions[currentQuestionIndex];
            const exp = document.createElement('div');
            exp.className = 'explanation';
            exp.innerHTML = `<h5>الإجابة النموذجية:</h5><p>${q.modelAnswer}</p>`;
            document.getElementById('optionsContainer').appendChild(exp);

            document.getElementById('nextBtn').classList.remove('d-none');
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
            loadQuestion();
            } else {
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('finalFormContainer').style.display = 'block';
            }
        }

        function saveStudentData() {
            const name = document.getElementById('studentName').value.trim();
            const id = document.getElementById('studentId').value.trim();
            if (!name || !id) { alert('أدخل الاسم وال ID.'); return; }

            const data = {
            studentName: name,
            studentId: id,
            subjectName: "شبكات",
            section: "ب",
            score: score,
            totalMCQ: mcqCount,
            percentage: mcqCount ? Math.round((score / mcqCount) * 100) : 0,
            timestamp: new Date().toISOString(),
            answers: userAnswers.map((a, i) => ({
                question: questions[i].question,
                type: questions[i].type,
                userAnswer: a,
                correctAnswer: questions[i].type === 'mcq' ? questions[i].options[questions[i].correct] : null,
                explanation: questions[i].type === 'mcq' ? questions[i].explanation : questions[i].modelAnswer
            }))
            };

            if (window.saveToFirebase) window.saveToFirebase(data);

            localStorage.removeItem('quiz-networks-b');
            showFinalResults(name, id, data.percentage);
        }

        function showFinalResults(name, id, pct) {
            document.getElementById('finalFormContainer').style.display = 'none';
            document.getElementById('resultContainer').style.display = 'block';

            document.getElementById('finalScore').textContent = `${score}/${mcqCount}`;
            let txt = "حاول مرة أخرى! 💪";
            if (pct >= 80) txt = "ممتاز! 🌟";
            else if (pct >= 60) txt = "جيد جدًا! 👍";
            else if (pct >= 40) txt = "لابأس! 📚";
            document.getElementById('resultText').textContent = txt;

            const expCont = document.getElementById('explanationsContainer');
            expCont.innerHTML = '<h3 class="text-light mb-4">جميع إجاباتك:</h3>';
            questions.forEach((q, i) => {
            const div = document.createElement('div');
            div.className = 'explanation';
            const userAns = userAnswers[i] || "لم تجب";
            if (q.type === 'mcq') {
                div.innerHTML = `
                <h5>السؤال ${i+1}: ${q.question}</h5>
                <p><strong>إجابتك:</strong> ${q.options[userAns] || 'لم تجب'}</p>
                <p><strong>الإجابة الصحيحة:</strong> ${q.options[q.correct]}</p>
                <p><strong>الشرح:</strong> ${q.explanation}</p>
                `;
            } else {
                div.innerHTML = `
                <h5>السؤال ${i+1} (مقالي): ${q.question}</h5>
                <p><strong>إجابتك:</strong> ${userAns}</p>
                <p><strong>الإجابة النموذجية:</strong> ${q.modelAnswer}</p>
                `;
            }
            expCont.appendChild(div);
            });
        }

        function shareToWhatsApp() {
            const cc = document.getElementById('countryCode').value.trim();
            const phone = document.getElementById('phoneNumber').value.trim();
            if (!cc || !phone) { alert('أدخل رمز الدولة ورقم الهاتف.'); return; }
            const full = cc + phone.replace(/^0+/, '');
            const msg = `لقد انتهيت من اختبار "شبكات - المجموعة ب" وحصلت على ${score}/${mcqCount}!`;
            window.open(`https://wa.me/${full}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFont('Amiri'); 
            doc.text('نتائج الاختبار', 105, 20, null, null, 'center');
            doc.text('شبكات - المجموعة ب', 20, 40);
            doc.text(`النتيجة: ${score}/${mcqCount}`, 20, 50);
            let y = 70;
            questions.forEach((q, i) => {
            if (y > 250) { doc.addPage(); y = 20; }
            doc.text(`السؤال ${i+1}: ${q.question}`, 20, y, { maxWidth: 170 });
            y += 10;
            const ans = userAnswers[i] || 'لم تجب';
            if (q.type === 'mcq') {
                doc.text(`إجابتك: ${q.options[ans] || 'لم تجب'}`, 25, y, { maxWidth: 165 });
                y += 10;
                doc.text(`الصحيحة: ${q.options[q.correct]}`, 25, y, { maxWidth: 165 });
            } else {
                doc.text(`إجابتك: ${ans}`, 25, y, { maxWidth: 165 });
            }
            y += 15;
            });
            doc.save('نتيجة_شبكات الحاسب_ب.pdf');
        }

        function restartQuiz() {
            localStorage.removeItem('quiz-networks-b');
            currentQuestionIndex = 0; userAnswers = []; score = 0;
            document.getElementById('resultContainer').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'block';
            loadQuestion();
        }

        function backToMaterials() {
            localStorage.removeItem('quiz-networks-b');
            window.location.href = 'materials.html';
        }

        function exitQuiz() {
            if (confirm('هل تريد إنهاء الاختبار؟')) {
            localStorage.removeItem('quiz-networks-b');
            window.location.href = 'materials.html';
            }
        }
        </script>
</body>
</html>